###set($layout = "/layout/layout2.vm")
#set($pageTitle = "title")
#set($JS = ["/js/jquery.form.min.js", "/js/page/customerInfo/new-update.js"])
<div class="yw_buyerContainer">
    <div class="yw_breadcrumb">
        当前位置：<a href="javascript:;">$!{currentPosStr}</a>
    </div>
    <div class="yw_box">
        <form action="/customerInfo/save"  method="post" class="layui-form" id="newForm_customerInfo" enctype="multipart/form-data">
            <div class="layui-form-item">
                <label for="name" class="layui-form-label">姓名</label>
                <div class="layui-input-block">
                    <input type="text" class="layui-input" id="name" name="name" value="$!{param.name}" >
                </div>
            </div>
            <div class="layui-form-item">
                <label for="phone" class="layui-form-label">手机号</label>
                <div class="layui-input-block">
                    <input type="text" class="layui-input" id="phone" name="phone" value="$!{param.phone}" >
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">性别</label>
                <div class="layui-input-block">
                    <input type="radio" name="gender" value="0" title="男" #if($!{param.gender}==0) checked="" #end>
                    <div class="layui-unselect layui-form-radio"><i class="layui-anim layui-icon"></i><span>男</span></div>
                    <input type="radio" name="gender" value="1" title="女" #if($!{param.gender}==1) checked="" #end>
                    <div class="layui-unselect layui-form-radio"><i class="layui-anim layui-icon"></i><span>女</span></div>
                </div>
            </div>
            <div class="layui-form-item">
                <div class="layui-inline">
                    <label class="layui-form-label">国籍</label>
                    <div class="layui-input-inline width-full">
                        <select name="nationality" id="nationality" lay-filter="nationality">
                        </select>
                        <div class="layui-unselect layui-form-select">
                            <div class="layui-select-title">
                                <input type="text" placeholder="请选择" value="" readonly="" class="layui-input layui-unselect"><i class="layui-edge"></i>
                            </div>
                            <dl class="layui-anim layui-anim-upbit" style="">
                            </dl>
                        </div>
                    </div>
                </div>
            </div>
            <div class="layui-form-item">
                <div class="layui-inline">
                    <label class="layui-form-label">省份</label>
                    <div class="layui-input-inline width-full">
                        <select name="province" id="province" lay-filter="province">
                        </select>
                        <div class="layui-unselect layui-form-select">
                            <div class="layui-select-title">
                                <input type="text" placeholder="请选择" value="" readonly="" class="layui-input layui-unselect"><i class="layui-edge"></i>
                            </div>
                            <dl class="layui-anim layui-anim-upbit" style="">
                            </dl>
                        </div>
                    </div>
                </div>
            </div>
            <div class="layui-form-item">
                <div class="layui-inline">
                    <label class="layui-form-label">地市</label>
                    <div class="layui-input-inline width-full">
                        <select name="city" id="city" lay-filter="city">
                        </select>
                        <div class="layui-unselect layui-form-select">
                            <div class="layui-select-title">
                                <input type="text" placeholder="请选择" value="" readonly="" class="layui-input layui-unselect"><i class="layui-edge"></i>
                            </div>
                            <dl class="layui-anim layui-anim-upbit" style="">
                            </dl>
                        </div>
                    </div>
                </div>
            </div>
            <div class="layui-form-item">
                <label for="companyName" class="layui-form-label">单位</label>
                <div class="layui-input-block">
                    <input type="text" class="layui-input" id="companyName" name="companyName" value="$!{param.companyName}" size="50">
                </div>
            </div>
            <div class="layui-form-item">
                <label for="address" class="layui-form-label">联系地址</label>
                <div class="layui-input-block">
                    <input type="text" class="layui-input" id="address" name="address" value="$!{param.address}" size="50">
                </div>
            </div>
            <div class="layui-form-item">
                <label for="imageUrl" class="layui-form-label">图像</label>
                <div class="layui-input-block">
                    <input type="file" name="file" id="file" accept="image/png,image/jpeg">
                </div>
            </div>
            <div class="layui-form-item">
                <label for="qq" class="layui-form-label">联系qq</label>
                <div class="layui-input-block">
                    <input type="text" class="layui-input" id="qq" name="qq" value="$!{param.qq}" >
                </div>
            </div>
            <div class="layui-form-item">
                <label for="weixin" class="layui-form-label">微信号</label>
                <div class="layui-input-block">
                    <input type="text" class="layui-input" id="weixin" name="weixin" value="$!{param.weixin}" >
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">黑名单</label>
                <div class="layui-input-block">
                    <input type="radio" name="isBlack" value="0" title="否" #if($!{param.isBlack}==0) checked="" #end>
                    <div class="layui-unselect layui-form-radio"><i class="layui-anim layui-icon"></i><span>否</span></div>
                    <input type="radio" name="isBlack" value="1" title="是" #if($!{param.isBlack}==1) checked="" #end>
                    <div class="layui-unselect layui-form-radio"><i class="layui-anim layui-icon"></i><span>是</span></div>
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">VIP</label>
                <div class="layui-input-block">
                    <input type="radio" name="isVip" value="0" title="否" #if($!{param.isVip}==0) checked="" #end>
                    <div class="layui-unselect layui-form-radio"><i class="layui-anim layui-icon"></i><span>否</span></div>
                    <input type="radio" name="isVip" value="1" title="是" #if($!{param.isVip}==1) checked="" #end>
                    <div class="layui-unselect layui-form-radio"><i class="layui-anim layui-icon"></i><span>是</span></div>
                </div>
            </div>
            <div class="layui-form-item">
                <div class="layui-input-block">
                    <button type="submit" class="layui-btn layui-btn-normal">添加</button>
                </div>
            </div>
        </form>
    </div>
</div>
<script>
    var map = {};
    map = JSON.parse('$areaMap');

    var selectedCountry = '$param.nationality';
    var selectedProvince = '$param.province';
    var selectedCity = '$param.city';

    var htmlStr = "";
    for (var i=0; i<map.countries.length; i++) {
        var sel = "";
        if (selectedCountry === map.countries[i].country) {
            sel = "selected";
        }
        htmlStr = htmlStr + "<option value=\"" + map.countries[i].country + "\" " + sel + " >" + map.countries[i].country + "</option>";
    }

    $('#nationality').html(htmlStr);
    function changeNationality() {
        var country = $('#nationality').val();
        if (country === null) {
            $('#city').html("");
            $('#country').html("");
            return;
        }
        for (var i=0; i<map.countries.length; i++) {
            if (country === map.countries[i].country) {
                var htmlStr = "";
                for (var j=0; j<map.countries[i].provinces.length; j++) {
                    var sel = "";
                    if (selectedProvince === map.countries[i].provinces[j].province) {
                        sel = "selected";
                    }
                    htmlStr = htmlStr + "<option value=\"" + map.countries[i].provinces[j].province + "\" " + sel + " >" + map.countries[i].provinces[j].province + "</option>";
                }
                $('#province').html(htmlStr);
                break;
            }
        }
        $('#city').html("");
    }
    function changeProvince() {
        var country = $('#nationality').val();
        var province = $('#province').val();
        if (country === null || province === null) {
            $('#city').html("");
            return;
        }
        for (var i=0; i<map.countries.length; i++) {
            if (country === map.countries[i].country) {
                for (var j=0; j<map.countries[i].provinces.length; j++) {
                    console.log(map.countries[i].provinces[j].province);
                    if (province === map.countries[i].provinces[j].province) {
                        var htmlStr = "";
                        for (var k=0; k<map.countries[i].provinces[j].cities.length; k++) {
                            var sel = "";
                            if (selectedProvince === map.countries[i].provinces[j].cities[k]) {
                                sel = "selected";
                            }
                            htmlStr = htmlStr + "<option value=\"" + map.countries[i].provinces[j].cities[k] + "\" " + sel + " >" + map.countries[i].provinces[j].cities[k] + "</option>";
                        }
                        $('#city').html(htmlStr);
                        break;
                    }
                }
                break;
            }
        }
    }
    changeNationality();
    changeProvince();
    layui.use('form', function() {
        var form = layui.form;
        form.on('select(nationality)', function (data) {
            changeNationality();
            form.render('select');
        });
        form.on('select(province)', function (data) {
            changeProvince();
            form.render('select');
        });
    });
</script>